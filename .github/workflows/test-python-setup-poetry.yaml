name: Test python-setup-poetry action

on:
  pull_request:
    branches:
      - main
    paths:
      - actions/python-poetry-release/action.yaml

env:
  POETRY_VERSION: "1.2.2"

jobs:
  tests:
    name: ${{ matrix.os }} / ${{ matrix.python-version }}
    runs-on: ${{ matrix.os }}-latest
    strategy:
      matrix:
        os: [Ubuntu, macOS, Windows]
        python-version: ["3.8", "3.9", "3.10"]
    steps:
      - uses: actions/checkout@v3

      - name: Set up Poetry
        uses: bakdata/ci-templates/actions/python-setup-poetry@fix/poetry-setup-windows
        with:
          poetry-version: ${{ env.POETRY_VERSION }}
          python-version: ${{ matrix.python-version }}
          working-directory: .tests/poetry

      - name: Check Poetry version
        shell: bash
        run: |
          [[ $(poetry --version) == "Poetry (version $POETRY_VERSION)" ]]

      - name: Check Python version
        shell: bash
        run: |
          poetry run python -c 'import platform; assert str(${{ matrix.python-version }}) in platform.python_version()'

      - name: Install Poetry package
        shell: bash
        run: poetry install
